
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Application Programming Interface (API) &#8212; RecSys Handbook</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=796348d33e8b1d947c94" rel="stylesheet">
<link href="../_static/styles/bootstrap.css?digest=796348d33e8b1d947c94" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=796348d33e8b1d947c94" rel="stylesheet">

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=796348d33e8b1d947c94" rel="stylesheet">
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2">
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2">
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=4ec06e9971c5264fbd345897d5258098f11cc577" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=796348d33e8b1d947c94">
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=796348d33e8b1d947c94">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=8bf782fb4ee92b3d3646425e50f299c4e1fd152d"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-1KXERRXYG5"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-1KXERRXYG5');
            </script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapter2/api_dev';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Containerization with Docker of a two-level recsys microservice" href="docker.html" />
    <link rel="prev" title="What comes after ML model development?" href="intro_to_deployment.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>

  
  <input type="checkbox" class="sidebar-toggle" name="__primary" id="__primary">
  <label class="overlay overlay-primary" for="__primary"></label>

  
  <input type="checkbox" class="sidebar-toggle" name="__secondary" id="__secondary">
  <label class="overlay overlay-secondary" for="__secondary"></label>

  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
      
<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
    </div>
  </div>

  
  <nav class="bd-header navbar navbar-expand-lg bd-navbar" id="navbar-main"><div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
      <span class="fa-solid fa-bars"></span>
  </label>
  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../index.html">

  
  
  
  
  
  
  

  
  
    <p class="title logo__title">RecSys Handbook</p>
  
</a>
    
  </div>

  
  <div class="col-lg-9 navbar-header-items">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../chapter1/intro_to_rekko.html">
                        Introduction to Recommendation Problem
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../chapter1/baseline.html">
                        Baseline Implementation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../chapter1/validation_metrics.html">
                        Metrics & Validation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../chapter1/content_filter.html">
                        Content-Based Filtering
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../chapter1/collab_filter.html">
                        Collaborative Filtering
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../chapter1/ranker.html">
                        Ranking Problem in Machine Learning
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../chapter1/full_pipeline.html">
                        Full Pipeline of the Two-level RecSys
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="intro_to_deployment.html">
                        Introduction to Production Code & Deployment
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="#">
                        API Development
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="docker.html">
                        Containerization with Docker
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../chapter3/intro_to_analytics.html">
                        INTRODUCTION TO PRODUCT ANALYTCS
                      </a>
                    </li>
                
                </div>
            </div>
            
    </ul>
</nav>
      </div>
      
    </div>

    <div id="navbar-end">
      
        <div class="navbar-end-item navbar-persistent--container">
          
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
        </div>
      
      
      <div class="navbar-end-item">
        <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
</button>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>


  
  
    <div class="navbar-persistent--mobile">
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
    </div>
  

  
  <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
  </label>
  

</div>
  </nav>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        
  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../chapter1/intro_to_rekko.html">
                        Introduction to Recommendation Problem
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../chapter1/baseline.html">
                        Baseline Implementation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../chapter1/validation_metrics.html">
                        Metrics & Validation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../chapter1/content_filter.html">
                        Content-Based Filtering
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../chapter1/collab_filter.html">
                        Collaborative Filtering
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../chapter1/ranker.html">
                        Ranking Problem in Machine Learning
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../chapter1/full_pipeline.html">
                        Full Pipeline of the Two-level RecSys
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="intro_to_deployment.html">
                        Introduction to Production Code & Deployment
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="#">
                        API Development
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="docker.html">
                        Containerization with Docker
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../chapter3/intro_to_analytics.html">
                        INTRODUCTION TO PRODUCT ANALYTCS
                      </a>
                    </li>
                
                </div>
            </div>
            
    </ul>
</nav>
      </div>
      
      </div>
    

    
    
    <div class="sidebar-header-items__end">
      
      <div class="navbar-end-item">
        <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
</button>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
    
  </div>

  
  <div class="sidebar-start-items sidebar-primary__section">
    <div class="sidebar-start-items__item">
  


<a class="navbar-brand logo" href="../index.html">

  
  
  
  
  
  
  

  
  
    <p class="title logo__title">RecSys Handbook</p>
  
</a>
    </div>
    <div class="sidebar-start-items__item">
<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
    </div>
    <div class="sidebar-start-items__item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    Welcome To The World Of Recommendations and Ranking
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">CHAPTER 1 - OVERVIEW OF RECOMMENDATION SYSTEMS</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../chapter1/intro_to_rekko.html">Introduction to Recommendation Problem</a></li>

<li class="toctree-l1"><a class="reference internal" href="../chapter1/baseline.html">Baseline Implementation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapter1/validation_metrics.html">Metrics &amp; Validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapter1/content_filter.html">Content-based Filtering in a Nutshell</a></li>

<li class="toctree-l1"><a class="reference internal" href="../chapter1/collab_filter.html">Collaborative Filtering</a></li>

<li class="toctree-l1"><a class="reference internal" href="../chapter1/ranker.html">Ranking Problem</a></li>


<li class="toctree-l1"><a class="reference internal" href="../chapter1/full_pipeline.html">Full Pipeline of the Two-level Recommender System</a></li>




</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">CHAPTER 2 - PRODUCTION CODE &amp; DEPLOYMENT</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="intro_to_deployment.html">What comes after ML model development?</a></li>



<li class="toctree-l1 current active"><a class="current reference internal" href="#">Application Programming Interface (<code class="docutils literal notranslate"><span class="pre">API</span></code>)</a></li>

<li class="toctree-l1"><a class="reference internal" href="docker.html">Containerization with Docker</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">CHAPTER 3 - Estimation of RecSys and other ML models in real world</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../chapter3/intro_to_analytics.html">Introduction to Product Analytics</a></li>

</ul>

    </div>
</nav>
    </div>
  </div>
  

  
  <div class="sidebar-end-items sidebar-primary__section">
    <div class="sidebar-end-items__item">
    </div>
  </div>

  
  <div id="rtd-footer-container"></div>

      </div>
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

        <div class="bd-content">
          <div class="bd-article-container">
            
            <div class="bd-header-article">
                



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        <label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" data-toggle="tooltip" data-placement="right" title="Toggle primary sidebar">
            <span class="fa-solid fa-bars"></span>
        </label>
    </div>
    <div class="header-article__right">


<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
  </ul>
</div>

<button onclick="toggleFullScreen()"
  class="btn btn-sm"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<div class="dropdown dropdown-repository-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      <li><a href="https://github.com/kshurik/rekko_handbook" target="_blank"
   class="btn btn-sm dropdown-item"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">repository</span>
</a>
</a>
      
      <li><a href="https://github.com/kshurik/rekko_handbook/issues/new?title=Issue%20on%20page%20%2Fchapter2/api_dev.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm dropdown-item"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">open issue</span>
</a>
</a>
      
  </ul>
</div>



<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      <li><a href="../_sources/chapter2/api_dev.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   data-toggle="tooltip"
data-placement="left"
title="Download notebook file"
>
  

<span class="btn__icon-container">
  <i class="fas fa-code"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</a>
      
      <li><a href="../_sources/chapter2/api_dev.md" target="_blank"
   class="btn btn-sm dropdown-item"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</a>
      
      <li>
<button onclick="printPdf(this)"
  class="btn btn-sm dropdown-item"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</a>
      
  </ul>
</div>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary" data-toggle="tooltip" data-placement="left" title="Toggle secondary sidebar">
            <span class="fa-solid fa-list"></span>
        </label>
    </div>
</div>
            </div>
            
            

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Application Programming Interface (API)</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Application Programming Interface (
   <code class="docutils literal notranslate">
    <span class="pre">
     API
    </span>
   </code>
   )
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#api-development">
   API development
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#flask-fastapi">
     Flask &amp; FastAPI
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#recsys-project-pipeline">
     RecSys Project Pipeline
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>

            <article class="bd-article" role="main">
              
  <section class="tex2jax_ignore mathjax_ignore" id="application-programming-interface-api">
<span id="chapter2-part2"></span><h1>Application Programming Interface (<code class="docutils literal notranslate"><span class="pre">API</span></code>)<a class="headerlink" href="#application-programming-interface-api" title="Permalink to this heading">#</a></h1>
<p>Previously, we discussed the process and tools of production code writing. In this chapter,
we will focus on Application Programming Interface - API which is used in any service to
communicate with each other. Let’s dive into that.</p>
<p>API stands for Application Programming Interface. It is a set of rules and protocols that
allows different software applications to communicate with each other. In simpler terms,
an API is like a waiter in a restaurant who takes your order and communicates it to the kitchen.
The kitchen prepares your food and gives it back to the waiter who then serves it to you.</p>
<p>Similarly, when you use an app on your phone or computer, it communicates with the server
through an API. The app sends a request to the server, and the server responds with the required data.
For example, when you search for something on Google, the app sends a request to the Google server
through an API, and the server responds with the search results.</p>
<p>APIs are essential for software development as they allow developers to create software that works
with other applications. This means that developers do not need to create everything from scratch,
but instead, they can use APIs to connect their software to other applications, services, or data sources.</p>
<p>In the case of a two-level recommender system, the API would allow different components of the system
to communicate with each other. For example, the client requests user data, which is then
processed by the first-level model. The API would allow the model to communicate with the feature
store to enrich the data and then pass it on to the ranker model. Finally, the ranker model would
use the API to send back the sorted items to the client.</p>
<p>When it comes to building APIs in Python, Flask and FastAPI are one of the popular frameworks
that come to mind. Both frameworks have their own strengths and weaknesses, and choosing
between them depends on the specific needs of the project which we will discuss further</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="api-development">
<h1>API development<a class="headerlink" href="#api-development" title="Permalink to this heading">#</a></h1>
<p>We dived into the world of APIs, web frameworks, and their application to building recommendation systems.
Now, we will introduce Flask, a popular Python web framework, and FastAPI, a newer and
faster web framework for building APIs.</p>
<p>After a brief overview, we will dive into a hands-on example of building an API using Flask.
Specifically, we will use Flask to build a two-level recommender system that recommends movies to users based
on their preferences - this will include both training and inference pipeline. This project will
showcase how Flask can be used to build a scalable and efficient API for machine learning-based applications.</p>
<section id="flask-fastapi">
<h2>Flask &amp; FastAPI<a class="headerlink" href="#flask-fastapi" title="Permalink to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">Flask</span></code> is a popular web framework for building APIs in Python that provides a simple and
flexible approach to building RESTful APIs. It is easy to learn, has a minimalistic design,
and is suitable for small to medium-sized projects. Flask is known for its flexibility,
simplicity, and intuitive API, which makes it easy to get started with building an API.
It is also a mature and well-established framework with a large community and a vast range
of third-party libraries available. Flask is also popular for its lightweight design and
excellent documentation, which makes it a popular choice for building small to medium-sized APIs.</p>
<p><code class="docutils literal notranslate"><span class="pre">FastAPI</span></code>, on the other hand, is a relatively new framework that is built on top of the Starlette
web framework and uses the Pydantic library for data validation and serialization. It is designed
to be fast, efficient, and easy to use, making it ideal for large-scale projects. FastAPI is known
for its high performance and speed, which is built on top of the Starlette web framework that uses
asynchronous programming to handle requests more efficiently. This allows FastAPI to handle a large
number of requests with minimal resources, making it ideal for building high-performance APIs.
FastAPI also has built-in support for data validation and serialization using the Pydantic library.
This makes it easy to define the API schema and ensures that the data sent and received by the API
is valid and conforms to the specified schema.</p>
<p>The two frameworks have their own set of pros and cons. Flask is very flexible and easy to use.
It has a simple and intuitive API, making it easy to get started with building an API. FastAPI,
on the other hand, is known for its high performance and speed, which makes it ideal for building
high-performance APIs. One of the key differences between Flask and FastAPI is their approach to
asynchronous programming. While Flask supports asynchronous programming, it is not built with it
in mind and as a result, it may not be as efficient as FastAPI when handling large numbers of requests.
FastAPI, on the other hand, is designed to handle asynchronous programming efficiently
and is built with performance in mind.</p>
<p>Another difference between the two frameworks is the level of abstraction they provide.
Flask is a low-level framework that gives developers complete control over the API’s functionality
and design. This level of control makes it easy to customize the API to meet specific requirements.
FastAPI, on the other hand, is a high-level framework that provides a lot of functionality out of
the box. This makes it easier to get started with building an API, but it may be
less flexible than Flask in some cases.</p>
<p>In terms of development time, Flask may be faster to set up and get started with due to its
simplicity and flexibility. FastAPI, on the other hand, may take longer to set up due to its more
complex design and additional dependencies. However, FastAPI’s performance benefits may make up
for the additional development time in the long run.</p>
<p>Overall, both Flask and FastAPI are excellent choices for building APIs in Python. Flask is
a mature and well-established framework that is easy to learn and flexible. It is ideal for building
small to medium-sized APIs. FastAPI, on the other hand, is a high-performance framework that is built
with performance in mind. It is ideal for building large-scale APIs that require high levels of
performance and efficiency. The choice between Flask and FastAPI ultimately depends on the specific
requirements of the project, the level of control needed, and the expected levels of performance and scalability.</p>
</section>
<section id="recsys-project-pipeline">
<h2>RecSys Project Pipeline<a class="headerlink" href="#recsys-project-pipeline" title="Permalink to this heading">#</a></h2>
<p>In the previous section, we discussed the theory of API development and compared FlaskAPI and FastAPI
frameworks for building APIs. Now, we will apply this knowledge to develop an API for a two-level
recommender system. Our recommender system has four parts as we discussed <a class="reference external" href="https://rekkobook.com/chapter2/intro_to_deployment.html#architecture-for-our-recsys-project">here</a>: a client, first-level training and inference
for candidate generation, a feature store that stores user and item features as parquet files, and a
reranker as the second-level model. The output of our API will be recommendations along with status
(success or error) and a message (null if the status is a success).</p>
<p>To develop this API, we will be using the Flask framework. Also, we will use the Flask <a class="reference external" href="https://flask.palletsprojects.com/en/1.1.x/appcontext/">app context</a> to load both the first-level and second-level models when the app is run for the first time.
Additionally, we will add caching of data downloading to reduce the response time of the API.</p>
<p>First, let’s look at the structure of the project illustrated below</p>
<p><img alt="" src="../_images/api_example.png" /></p>
<p>The breakdown of each component is as follows:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">/artefacts</span></code> - storage for model objects. Of course, in real production cloud storage is used and we could imitate that
by using <a class="reference external" href="https://simonjcarr.medium.com/running-s3-object-storage-locally-with-minio-f50540ffc239">minio</a> for local deployment,
but, first of all, we focus on general ideas and approaches;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/configs</span></code> - configuration files orchestrated by <a class="reference external" href="https://www.dynaconf.com/">Dynaconf</a> for convenience development;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/data_prep</span></code> - data preparation module for training and inference of ReRanker;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/models</span></code> - component with two modules for models - <a class="reference external" href="http://lfm.py">lfm.py</a> for LightFM, <a class="reference external" href="http://ranker.py">ranker.py</a> - for second-level model
and <a class="reference external" href="http://pipeline.py">pipeline.py</a> is designed for running all necessary steps for inference;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/utils</span></code> - some common functions to use everywhere;</p></li>
</ul>
<p>Also, in the root, we have several files we already mentioned - <code class="docutils literal notranslate"><span class="pre">Makefile</span></code>, <code class="docutils literal notranslate"><span class="pre">poetry.lock</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code>. I will skip them because
we discussed their need in the previous chapter. Here, we will focus on <a class="reference external" href="http://api.py">api.py</a>, <a class="reference external" href="http://train.py">train.py</a> and some details in model classes.
Let’s go top-down and elaborate on the first two modules.</p>
<p><code class="docutils literal notranslate"><span class="pre">[train.py]</span></code>(<a class="github reference external" href="https://github.com/kshurik/rekkobook/blob/chapter2/api_example/supplements/recsys/train.py">kshurik/rekkobook</a>) - can be run using <code class="docutils literal notranslate"><span class="pre">poetry</span> <span class="pre">run</span> <span class="pre">python</span> <span class="pre">train.py</span> <span class="pre">train_{model_name}</span></code> where model_name is either lfm or cbm.
It executes a training pipeline for a given model to use it further to run <a class="reference external" href="http://api.py">api.py</a> for inference. So, what does
<a class="reference external" href="http://train.py">train.py</a> have in a nutshell? It has two functions based on modules in <code class="docutils literal notranslate"><span class="pre">[/models]</span></code>(<a class="github reference external" href="https://github.com/kshurik/rekkobook/tree/chapter2/api_example/supplements/recsys/models">kshurik/rekkobook</a>).</p>
<ul class="simple">
<li><p>First, train_lfm uses <a class="reference external" href="https://github.com/kshurik/rekkobook/blob/chapter2/api_example/supplements/recsys/models/lfm.py">/models/lfm.py</a>
to train the LightFM model using either local parquet data if a path is given, otherwise, it uses prepared data from my GDrive;</p></li>
<li><p>Then, we have <a class="reference external" href="https://github.com/kshurik/rekkobook/blob/chapter2/api_example/supplements/recsys/models/ranker.py">/models/ranker.py</a> which
uses resulting artefacts from <code class="docutils literal notranslate"><span class="pre">poetry</span> <span class="pre">run</span> <span class="pre">python</span> <span class="pre">train.py</span> <span class="pre">train_lfm</span></code> to prepare data with <code class="docutils literal notranslate"><span class="pre">[/data_prep]</span></code>(<a class="github reference external" href="https://github.com/kshurik/rekkobook/blob/chapter2/api_example/supplements/recsys/data_prep/prepare_ranker_data.py">kshurik/rekkobook</a>) module for catboost and trains 2nd level model</p></li>
</ul>
<p>We discussed methods to train both models and I want to highlight their structure. I designed them to have similar structures with similar methods
Both <code class="docutils literal notranslate"><span class="pre">LFMModel</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">Ranker</span></code> from /models have two methods: fit() to train the model and save, infer() to use in production for inference.
Also, there is an is_infer parameter to define while initializing classes - if True it loads the model from a given path in <code class="docutils literal notranslate"><span class="pre">/[configs]</span></code>(<a class="github reference external" href="https://github.com/kshurik/rekkobook/blob/chapter2/api_example/supplements/recsys/configs/models_params.toml">kshurik/rekkobook</a>)</p>
<ul class="simple">
<li><p>Finally, we have <code class="docutils literal notranslate"><span class="pre">[pipeline.py]</span></code>(<a class="github reference external" href="https://github.com/kshurik/rekkobook/blob/chapter2/api_example/supplements/recsys/models/pipeline.py">kshurik/rekkobook</a>) which triggers all steps to get a recommendation for a given user id.
In the beginning, it goes to LFMModel artefacts to get the required number of candidates, then enriches those candidates
and users with features and after that uses ReRanker for the final output. It output has the following format (user_id: 176549, top_k: 10)</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># success</span>
<span class="p">{</span>
   <span class="s2">&quot;recommendations&quot;</span><span class="p">:[</span>
      <span class="mi">9728</span><span class="p">,</span>
      <span class="mi">13865</span><span class="p">,</span>
      <span class="mi">10440</span><span class="p">,</span>
      <span class="mi">15297</span><span class="p">,</span>
      <span class="mi">3734</span><span class="p">,</span>
      <span class="mi">4151</span><span class="p">,</span>
      <span class="mi">4880</span><span class="p">,</span>
      <span class="mi">142</span><span class="p">,</span>
      <span class="mi">2657</span><span class="p">,</span>
      <span class="mi">6809</span>
   <span class="p">],</span>
   <span class="s2">&quot;status&quot;</span><span class="p">:</span><span class="s2">&quot;success&quot;</span><span class="p">,</span>
   <span class="s2">&quot;msg&quot;</span><span class="p">:</span><span class="n">null</span>
<span class="p">}</span>

<span class="c1"># failed for some reason</span>
<span class="p">{</span>
   <span class="s2">&quot;recommendations&quot;</span><span class="p">:[],</span>
   <span class="s2">&quot;status&quot;</span><span class="p">:</span><span class="s2">&quot;error&quot;</span><span class="p">,</span>
   <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="s2">&quot;error message&quot;</span>
<span class="p">}</span>

</pre></div>
</div>
<p>To be it more concise, error handling must be better to distinguish between various reasons for faster debugging
(no such user - cold start problem, failed to fetch item features, user features etc.)</p>
<p>To wrap up, the main worker to get the job done with inference is done in <code class="docutils literal notranslate"><span class="pre">[api.py]</span></code>(<a class="github reference external" href="https://github.com/kshurik/rekkobook/blob/chapter2/api_example/supplements/recsys/api.py">kshurik/rekkobook</a>). run() extracts user_id and top_k parameters from the query and triggers get_recommnedations() - cristal clear.</p>
<p>As you can see, in the code to create a basic Flask application you just need to set 3 lines
that I highlighted with the line number from the right</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span>

<span class="c1"># init application</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span> <span class="c1"># line 1</span>

<span class="c1"># set URL to get predictions</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/get_recommendation&#39;</span><span class="p">)</span> <span class="c1"># line 2 -- definition of URL/endpoint for request</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">():</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">))</span>
    <span class="n">top_k</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;top_k&#39;</span><span class="p">))</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">get_recommendations</span><span class="p">(</span>
        <span class="n">user_id</span> <span class="o">=</span> <span class="n">user_id</span><span class="p">,</span>
        <span class="n">lfm_model</span> <span class="o">=</span> <span class="n">lfm_model</span><span class="p">,</span>
        <span class="n">ranker</span> <span class="o">=</span> <span class="n">ranker</span><span class="p">,</span>
        <span class="n">top_k</span> <span class="o">=</span> <span class="n">top_k</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="bp">cls</span> <span class="o">=</span> <span class="n">JsonEncoder</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s2">&quot;0.0.0.0&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8000</span><span class="p">)</span> <span class="c1"># line 3 - run application</span>
</pre></div>
</div>
<p>However, I wanted to highlight <a class="reference external" href="https://github.com/kshurik/rekkobook/blob/chapter2/api_example/supplements/recsys/api.py#L12">this</a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">app_context</span><span class="p">():</span>
    <span class="n">lfm_model</span> <span class="o">=</span>  <span class="n">LFMModel</span><span class="p">()</span>
    <span class="n">ranker</span> <span class="o">=</span> <span class="n">Ranker</span><span class="p">()</span>
</pre></div>
</div>
<p>detail called <a class="reference external" href="https://flask.palletsprojects.com/en/1.1.x/appcontext/">Flask App Context</a>. In production, you often need low latency to process
all incoming requests fast. Thus, in the case of ML models, you do not need to load models for each request but load them once when you deploy
your service. Usually, you need your model from scratch only if you updated it otherwise you use the same model to predict.</p>
<p>Another trick is used in the data preparation step <a class="reference external" href="https://github.com/kshurik/rekkobook/blob/chapter2/api_example/supplements/recsys/utils/utils.py#L10">here</a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@cached</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="n">TTLCache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span> <span class="n">ttl</span><span class="o">=</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">12</span><span class="p">),</span> <span class="n">timer</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">))</span>
</pre></div>
</div>
<p>To ensure that the API is efficient, we will also add caching of data downloading. This will help to reduce the number
of requests that need to be made to the feature store and improve the response time of the API. It is a decorator provided
by <code class="docutils literal notranslate"><span class="pre">cachetools</span></code> library. The idea is to read data once in 12 hours assuming we do not update it more frequently. Also,
it could be developed such that depending on the data source different time thresholds could be set. For instance,
movies’ metadata will not change more likely (description, genre etc) while users’ data can be changed more often
depending on their watching behavior.</p>
<p>Overall, all the code can be found <a class="reference external" href="https://github.com/kshurik/rekkobook/tree/chapter2/api_example/supplements/recsys">here</a>
at branch chapter2/api_example to clone, run and get a full understanding of what is going on</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./chapter2"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

            </article>
            

            
            
            <footer class="bd-footer-article">
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
  <a class='left-prev' id="prev-link" href="intro_to_deployment.html" title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
          <p class="prev-next-subtitle">previous</p>
          <p class="prev-next-title">What comes after ML model development?</p>
      </div>
  </a>
  <a class='right-next' id="next-link" href="docker.html" title="next page">
  <div class="prev-next-info">
      <p class="prev-next-subtitle">next</p>
      <p class="prev-next-title">Containerization with Docker of a two-level recsys microservice</p>
  </div>
  <i class="fa-solid fa-angle-right"></i>
  </a>
</div>
            </footer>
            
          </div>
          
          
          
            <div class="bd-sidebar-secondary bd-toc">
              
<div class="toc-item">
  
<div class="tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
</div>
<nav id="bd-toc-nav" class="page-toc">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Application Programming Interface (
   <code class="docutils literal notranslate">
    <span class="pre">
     API
    </span>
   </code>
   )
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#api-development">
   API development
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#flask-fastapi">
     Flask &amp; FastAPI
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#recsys-project-pipeline">
     RecSys Project Pipeline
    </a>
   </li>
  </ul>
 </li>
</ul>

</nav>
</div>

            </div>
          
          
        </div>
        <footer class="bd-footer-content">
          <div class="bd-footer-content__inner">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Shuhrat Khalilbekov
</p>

  </div>
  
  <div class="footer-item">
    
<p class="copyright">

    &copy; Copyright 2022.<br>

</p>

  </div>
  
  <div class="footer-item">
    <p class="last-updated">
Last updated on None.<br>
</p>
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </div>
        </footer>
        

      </main>
    </div>
  </div>

  
    
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=796348d33e8b1d947c94"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=796348d33e8b1d947c94"></script>

  </body>
</html>